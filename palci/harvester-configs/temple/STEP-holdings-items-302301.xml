<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<transformationStep uri="http://localhost:8080/harvester/records/steps/4007">
    <id>302301</id>
    <XmlTransformStep>
        <description>Holdings and Items, Temple</description>
        <inputFormat>XML</inputFormat>
        <name>Holdings and Items, Temple</name>
        <outputFormat>XML</outputFormat>
        <script>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;xsl:stylesheet&#xD;
  version="1.0"&#xD;
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&#xD;
  xmlns:marc="http://www.loc.gov/MARC21/slim"&#xD;
  &gt;&#xD;
&#xD;
  &lt;xsl:strip-space elements="*"/&gt;&#xD;
  &lt;xsl:output indent="yes" method="xml" version="1.0" encoding="UTF-8"/&gt;&#xD;
&#xD;
  &lt;xsl:template match="record"&gt;&#xD;
    &lt;record&gt;&#xD;
        &lt;xsl:for-each select="@* | node()"&gt;&#xD;
            &lt;xsl:copy-of select="."/&gt;&#xD;
        &lt;/xsl:for-each&gt;&#xD;
        &lt;xsl:apply-templates/&gt;&#xD;
    &lt;/record&gt;&#xD;
  &lt;/xsl:template&gt;&#xD;
&#xD;
  &lt;xsl:variable name="WILL_LEND"&gt;46970b40-918e-47a4-a45d-b1677a2d3d46&lt;/xsl:variable&gt; &lt;!-- FOLIO Inventory ILL Policy value 'Will lend' --&gt;&#xD;
  &lt;xsl:variable name="WILL_NOT_LEND"&gt;b0f97013-87f5-4bab-87f2-ac4a5191b489&lt;/xsl:variable&gt; &lt;!-- FOLIO Inventory ILL Policy value 'Will not lend' --&gt;&#xD;
&#xD;
  &lt;xsl:template match="//marc:record"&gt;&#xD;
    &lt;xsl:choose&gt;&#xD;
      &lt;xsl:when test="marc:datafield[@tag='HLD']"&gt;&#xD;
        &lt;holdingsRecords&gt;&#xD;
           &lt;arr&gt;&#xD;
             &lt;xsl:for-each select="marc:datafield[@tag='HLD']"&gt;&#xD;
               &lt;xsl:variable name="holdingsId" select="marc:subfield[@code='8']"/&gt;&#xD;
               &lt;i&gt;&#xD;
                 &lt;formerIds&gt;&#xD;
                   &lt;arr&gt;&#xD;
                     &lt;i&gt;&#xD;
                       &lt;xsl:value-of select="marc:subfield[@code='8']"/&gt;&#xD;
                     &lt;/i&gt;&#xD;
                   &lt;/arr&gt;&#xD;
                 &lt;/formerIds&gt;&#xD;
                 &lt;illPolicyId&gt;&#xD;
                    &lt;xsl:choose&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='aarc'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='aleisure'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='imc'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='intref'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='media'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='micro'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='newbooks'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='oversize'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reference'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reserve'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='stacks'"&gt;&lt;xsl:value-of select="$WILL_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='asrs'"&gt;&lt;xsl:value-of select="$WILL_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='media'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reference'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='rarestacks'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='media'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reserve'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='DSC'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='games'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='REF'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='dss_reserv'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='circ'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='intref'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='leisure'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='medhum'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='oversize'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reference'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reserve'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='serials'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='stacks'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='techserv'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='harrisburg'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='intref'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='media'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='oversize'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reference'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reserve'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='stacks'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='media'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='osaka'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reference'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='remote'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reserve'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='serials'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='stacks'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='a_rare'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='b_rare'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='g_remote'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='l_remote'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='p_GovDocs'"&gt;&lt;xsl:value-of select="$WILL_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='p_govdocmf'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='p_media'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='p_micro'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='p_oversize'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='p_remote'"&gt;&lt;xsl:value-of select="$WILL_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='kiosk'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='archives'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='closestack'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='govdoc'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='hirst'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='media'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='micro'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='open3'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='open3a'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='open4'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='open4a'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='open5'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='open5a'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='open6a'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='oversize2'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='oversize5a'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='pamphlets'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='rarestacks'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='rawle'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='rawle3'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reference'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reserve'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='serials'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='specintl'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='specpa'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='stacks'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='trials'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='hirsch'"&gt;&lt;xsl:value-of select="$WILL_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='juvenile'"&gt;&lt;xsl:value-of select="$WILL_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='leisure'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='m_reserve'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='newbooks'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reference'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reserve'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='serials'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='servicedsk'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='stacks'"&gt;&lt;xsl:value-of select="$WILL_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='storage'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='techserv'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='intref'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='leisure'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='media'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reference'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reserve'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='serials'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='stacks'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='techserv'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='plc'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='presser'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='exhibit'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='fiction'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='media'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='oversize'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reference'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='reserve'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='serials'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='stacks'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test="marc:subfield[@code='c']='rarestacks'"&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:when&gt;&#xD;
                    &lt;xsl:otherwise&gt;&lt;xsl:value-of select="$WILL_NOT_LEND"/&gt;&lt;/xsl:otherwise&gt;&#xD;
                    &lt;/xsl:choose&gt;&#xD;
                &lt;/illPolicyId&gt;&#xD;
                 &lt;permanentLocationIdHere&gt;&lt;xsl:value-of select="marc:subfield[@code='c']"/&gt;&lt;/permanentLocationIdHere&gt;&#xD;
                 &lt;callNumber&gt;&#xD;
                   &lt;xsl:for-each select="marc:subfield[@code='h' or @code='i']"&gt;&#xD;
                     &lt;xsl:if test="position() &gt; 1"&gt;&#xD;
                       &lt;xsl:text&gt; &lt;/xsl:text&gt;&#xD;
                     &lt;/xsl:if&gt;&#xD;
                     &lt;xsl:value-of select="."/&gt;&#xD;
                   &lt;/xsl:for-each&gt;&#xD;
                 &lt;/callNumber&gt;&#xD;
                 &lt;items&gt;&#xD;
                   &lt;arr&gt;&#xD;
                     &lt;xsl:for-each select="../marc:datafield[@tag='ITM']"&gt;&#xD;
                        &lt;xsl:if test="marc:subfield[@code='x']=$holdingsId"&gt;&#xD;
                            &lt;i&gt;&#xD;
                            &lt;itemIdentifier&gt;&#xD;
                                &lt;xsl:value-of select="marc:subfield[@code='a']"/&gt;&#xD;
                            &lt;/itemIdentifier&gt;&#xD;
                            &lt;barcode&gt;&#xD;
                                &lt;xsl:value-of select="marc:subfield[@code='b']"/&gt;&#xD;
                            &lt;/barcode&gt;&#xD;
                            &lt;permanentLoanTypeId&gt;2b94c631-fca9-4892-a730-03ee529ffe27&lt;/permanentLoanTypeId&gt;                    &lt;!-- Can circulate --&gt;&#xD;
                            &lt;materialTypeId&gt;&#xD;
                                &lt;xsl:choose&gt;&#xD;
                                &lt;xsl:when test="marc:subfield[@code='d']='BOOK'"&gt;1a54b431-2e4f-452d-9cae-9cee66c9a892&lt;/xsl:when&gt; &lt;!-- Book --&gt;&#xD;
                                &lt;xsl:otherwise&gt;71fbd940-1027-40a6-8a48-49b44d795e46&lt;/xsl:otherwise&gt;                              &lt;!-- Unspecified --&gt;&#xD;
                                &lt;/xsl:choose&gt;&#xD;
                            &lt;/materialTypeId&gt;&#xD;
                            &lt;status&gt;&#xD;
                                &lt;name&gt;Unknown&lt;/name&gt;&#xD;
                            &lt;/status&gt;&#xD;
                            &lt;/i&gt;&#xD;
                        &lt;/xsl:if&gt;&#xD;
                     &lt;/xsl:for-each&gt;&#xD;
                   &lt;/arr&gt;&#xD;
                 &lt;/items&gt;&#xD;
               &lt;/i&gt;&#xD;
             &lt;/xsl:for-each&gt;&#xD;
           &lt;/arr&gt;&#xD;
         &lt;/holdingsRecords&gt;&#xD;
       &lt;/xsl:when&gt;&#xD;
      &lt;xsl:otherwise&gt;&#xD;
        &lt;holdingsRecords&gt;&#xD;
          &lt;arr&gt;&#xD;
            &lt;i&gt;&#xD;
              &lt;permanentLocationIdHere /&gt;&#xD;
            &lt;/i&gt;&#xD;
          &lt;/arr&gt;&#xD;
        &lt;/holdingsRecords&gt;&#xD;
      &lt;/xsl:otherwise&gt;&#xD;
    &lt;/xsl:choose&gt;&#xD;
  &lt;/xsl:template&gt;&#xD;
  &lt;xsl:template match="text()"/&gt;&#xD;
&lt;/xsl:stylesheet&gt;</script>
        <id>302301</id>
        <testData></testData>
        <testOutput></testOutput>
    </XmlTransformStep>
</transformationStep>
