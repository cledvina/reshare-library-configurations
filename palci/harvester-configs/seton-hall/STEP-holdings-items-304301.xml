<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<transformationStep uri="http://localhost:8080/harvester/records/steps/304301">
  <id>304301</id>
  <XmlTransformStep>
        <id>304301</id>
        <description>Holdings and Items, Seton Hall</description>
        <inputFormat>XML</inputFormat>
        <name>Holdings and Items, Seton Hall</name>
        <outputFormat>XML</outputFormat>
        <script>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
          &lt;xsl:stylesheet&#xD;
            version="1.0"&#xD;
            xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&#xD;
            &gt;&#xD;
          &#xD;
            &lt;xsl:strip-space elements="*"/&gt;&#xD;
            &lt;xsl:output indent="yes" method="xml" version="1.0" encoding="UTF-8"/&gt;&#xD;
            &lt;xsl:template match="/"&gt;&#xD;
              &lt;collection&gt;&#xD;
                &lt;xsl:apply-templates /&gt;&#xD;
              &lt;/collection&gt;&#xD;
            &lt;/xsl:template&gt;&#xD;
          &#xD;
            &lt;xsl:template match="record"&gt;&#xD;
              &lt;record&gt;&#xD;
                  &lt;xsl:for-each select="@* | node()"&gt;&#xD;
                      &lt;xsl:copy-of select="."/&gt;&#xD;
                  &lt;/xsl:for-each&gt;&#xD;
                  &lt;xsl:apply-templates/&gt;&#xD;
              &lt;/record&gt;&#xD;
            &lt;/xsl:template&gt;&#xD;
          &#xD;
            &lt;xsl:template match="original/record"&gt;&#xD;
                &lt;xsl:if test="datafield[@tag='876']"&gt;&#xD;
                  &lt;holdingsRecords&gt;&#xD;
                     &lt;arr&gt;&#xD;
                       &lt;xsl:for-each select="datafield[@tag='876']"&gt;&#xD;
                         &lt;xsl:variable name="itemId" select="subfield[@code='p']"/&gt;&#xD;
                         &lt;xsl:variable name="holdingPos" select="position()"/&gt;&#xD;
                         &lt;i&gt;&#xD;
                           &lt;formerIds&gt;&#xD;
                             &lt;arr&gt;&#xD;
                               &lt;i&gt;&#xD;
                                 &lt;xsl:value-of select="subfield[@code='p']"/&gt;&#xD;
                               &lt;/i&gt;&#xD;
                             &lt;/arr&gt;&#xD;
                           &lt;/formerIds&gt;&#xD;
                           &lt;xsl:for-each select="../datafield[@tag='852']"&gt;&#xD;
                             &lt;xsl:if test="position() = $holdingPos"&gt;&#xD;
                              &lt;permanentLocationIdHere&gt;&lt;xsl:value-of select="subfield[@code='b']"/&gt;.&lt;xsl:value-of select="subfield[@code='c']"/&gt;&lt;/permanentLocationIdHere&gt;&#xD;
                             &lt;/xsl:if&gt;&#xD;
                             &lt;callNumber&gt;&#xD;
                               &lt;xsl:value-of select="subfield[@code='h']"/&gt;&lt;xsl:value-of select="subfield[@code='i']"/&gt;&#xD;
                            &lt;/callNumber&gt;&#xD;
                          &lt;/xsl:for-each&gt;&#xD;
                           &#xD;
                           &lt;items&gt;&#xD;
                             &lt;arr&gt;&#xD;
                               &lt;xsl:for-each select="../datafield[@tag='852']"&gt;&#xD;
                                  &lt;xsl:if test="position() = $holdingPos"&gt;&#xD;
                                  &lt;i&gt;&#xD;
                                    &lt;itemIdentifier&gt;&#xD;
                                      &lt;xsl:value-of select="$itemId"/&gt;&#xD;
                                    &lt;/itemIdentifier&gt;&#xD;
                                    &lt;barcode&gt;&#xD;
                                      &lt;xsl:value-of select="$itemId"/&gt;&#xD;
                                    &lt;/barcode&gt;&#xD;
                                    &lt;permanentLoanTypeId&gt;2b94c631-fca9-4892-a730-03ee529ffe27&lt;/permanentLoanTypeId&gt;                    &lt;!-- Can circulate --&gt;&#xD;
                                    &lt;materialTypeId&gt;1a54b431-2e4f-452d-9cae-9cee66c9a892&lt;/materialTypeId&gt;&#xD;
                                    &lt;status&gt;&#xD;
                                      &lt;name&gt;Unknown&lt;/name&gt;&#xD;
                                    &lt;/status&gt;&#xD;
                                  &lt;/i&gt;&#xD;
                                  &lt;/xsl:if&gt;&#xD;
                               &lt;/xsl:for-each&gt;&#xD;
                             &lt;/arr&gt;&#xD;
                           &lt;/items&gt;&#xD;
                         &lt;/i&gt;&#xD;
                       &lt;/xsl:for-each&gt;&#xD;
                     &lt;/arr&gt;&#xD;
                  &lt;/holdingsRecords&gt;&#xD;
                &lt;/xsl:if&gt;&#xD;
            &lt;/xsl:template&gt;&#xD;
            &lt;xsl:template match="text()"/&gt;&#xD;
          &lt;/xsl:stylesheet&gt;</script>
        <testData></testData>
        <testOutput></testOutput>
    </XmlTransformStep>
</transformationStep>
